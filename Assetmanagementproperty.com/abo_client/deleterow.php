<?php
 session_start(); include_once("config.php"); $conn = null; if (!tryConnect()) { die(); } loadConfig(); loadAllCfg(); if (isset($_SESSION['user'])) { } else { if (@$cfgCustom["loginType"] != "No Password" && @$cfgCustom["loginType"] != "") { header("Location: login.php"); die(); } } $table = @mysqli_real_escape_string($conn, $_GET["name"]); $primary = @mysqli_real_escape_string($conn, $_GET["primary"]); $primaryValue = @mysqli_real_escape_string($conn, $_GET["primaryValue"]); if (@$cfgTables["eraselevel_$table"] > 0) { $t = explode('/', $cfgCustom["tableLoginPwd"]); if (isset($t[3])) { $level = 0 + zbSQL("SELECT `{$t[3]}` FROM {$t[0]} WHERE {$t[1]}='{$_SESSION['user']}'"); if ($cfgTables["eraselevel_$table"] > $level) { appendLog('?', $table, 'Attempted erase but level not enough'); exit; } } } $sql = "DELETE FROM $table WHERE $primary='$primaryValue' LIMIT 1"; $result = @$conn->query($sql); if (@$cfgLog["chkdelete_$table"]) { appendLog('D', $table, $sql); } if ($result) { ?><script> $.notify("Element from <?php echo $table?> succesfully deleted!", "success"); </script><?php
} else { ?><script> $.notify("Error Deleting... <?php echo $conn->error?>", "error"); </script><?php
} ?><script>
  document.getElementById("table_<?php echo $table?>").innerHTML = '<?php echo zbSQL("SELECT COUNT(*) FROM $table")?>';
</script><?php
 $hasDetails = hasDetails($table); if ($hasDetails = hasDetails($table)) { $sql = "DELETE FROM `$hasDetails` WHERE $hasDetails.`{$cfgTables["selectlinktomasterdmaster_$hasDetails"]}`=$primaryValue"; $result = @$conn->query($sql); if ($result) { ?><script> $.notify("All details from <?php echo $table?> succesfully deleted!", "success"); </script><?php
 } else { ?><script> $.notify("Error Deleting... <?php echo $conn->error?>", "error"); </script><?php
 } } function hasDetails($table) { global $db, $cfgTables; $k = array_keys($db); for($i=0; $i<count($k); ++$i) { if (@$cfgTables["selectMaster_chkdet_".$k[$i]] == $table) return $k[$i]; } return null; } ?>