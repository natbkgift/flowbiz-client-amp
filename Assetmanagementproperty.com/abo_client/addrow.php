<?php
 session_start(); include_once("config.php"); $conn = null; if (!tryConnect()) { die(); } $name = @mysqli_real_escape_string($conn, $_GET["name"]); $primary = @mysqli_real_escape_string($conn, $_GET["primary"]); loadConfig(); loadAllCfg(); if (isset($_SESSION['user'])) { } else { if (@$cfgCustom["loginType"] != "No Password" && @$cfgCustom["loginType"] != "") { header("Location: login.php"); die(); } } if (@$cfgTables["addlevel_$name"] > 0) { $t = explode('/', $cfgCustom["tableLoginPwd"]); if (isset($t[3])) { $level = 0 + zbSQL("SELECT `{$t[3]}` FROM {$t[0]} WHERE {$t[1]}='{$_SESSION['user']}'"); if ($cfgTables["addlevel_$name"] > $level) { appendLog('?', $name, 'Attempted add but level not enough'); exit; } } } $sortOrder = ''; $sortField = ''; if (@$cfgTables["sortField_$name"]) { $sortField = $cfgTables["sortField_$name"]; if (@$cfgDefault['chkInsertFirstPosition']) { $sortOrder = 0+@zbSQL("SELECT MIN({$cfgTables["sortField_$name"]}) FROM $name"); $sortOrder--; } else { $sortOrder = 0+@zbSQL("SELECT MAX({$cfgTables["sortField_$name"]}) FROM $name"); $sortOrder++; } } if (@$cfgTables["multiuser_$name"]) { $primary = zbSQL("SELECT COLUMN_NAME FROM information_schema.KEY_COLUMN_USAGE WHERE TABLE_NAME = '$name' AND CONSTRAINT_NAME = 'PRIMARY'"); $t = explode('/', @$cfgCustom["tableLoginPwd"]); $s = "SELECT `$primary` FROM {$t[0]} WHERE `{$t[1]}`='{$_SESSION['user']}'"; $multiUserId = @zbSQL($s); if ($sortOrder) { $conn->query("INSERT INTO `$name` (`{$cfgTables["multiuser_$name"]}`, `$sortField`) VALUES ('$multiUserId', $sortOrder);"); } else { $conn->query("INSERT INTO `$name` (`{$cfgTables["multiuser_$name"]}`) VALUES ('$multiUserId');"); } } else { if (@$cfgTables["sortField_$name"]) { $conn->query("INSERT INTO `$name` (`$sortField`) VALUES ($sortOrder);"); } else { $conn->query("INSERT INTO `$name` () VALUES ();"); } } if (@$cfgLog["chkadd_$name"]) { appendLog('A', $name, null); } $lastId = $conn->insert_id; ?><script>
  editRow('<?=$name?>', '<?=$primary?>', <?=$lastId?>);
</script>
